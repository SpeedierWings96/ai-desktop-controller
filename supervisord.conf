[supervisord]
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
nodaemon=true

[program:vncserver]
command=/bin/sh -c \
    "mkdir -p /root/.vnc && \
     x11vnc -storepasswd ${VNC_PASSWORD} /root/.vnc/passwd >/dev/null 2>&1 || true; \
     vncserver ${DISPLAY} -geometry ${RESOLUTION} -depth ${DEPTH} -localhost no"
autorestart=true
priority=10

[program:novnc]
command=/bin/sh -c "websockify --web=/usr/share/novnc/ ${NOVNC_PORT} localhost:${VNC_PORT}"
autorestart=true
priority=20

[program:xfce4]
command=/bin/sh -c "export USER=root; startxfce4"
environment=DISPLAY="${DISPLAY}",USER="root"
autorestart=true
priority=30

[program:controller]
directory=/app
command=/bin/sh -c "uvicorn controller_server:app --host 0.0.0.0 --port 8765"
environment=DISPLAY="${DISPLAY}",USER="root"
autorestart=true
priority=35

[program:app]
directory=/app
command=/bin/sh -c "python3 run.py || python3 ai_desktop_controller.py"
autorestart=true
priority=40


